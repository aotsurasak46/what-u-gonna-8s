@{
    ViewData["Title"] = "Home Page";
}
@using what_u_gonna_eat.ViewModels;
@model DeliverPostView
<link rel="stylesheet" href="~/css/DeliverPost.css" />
<div class="text-center">
    
    <form method="POST" asp-controller="DeliverPost" asp-action="Create" id="create-form">
        <select asp-for="deliverPost.Restaurant" class="form-select form-select-sm" aria-label=".form-select-sm example">
            <option selected>Select Restaurant</option>
            <option value="Pratep">Pratep</option>
            <option value="Sia O">Sia O</option>
            <option value="T PangGon">T PangGon</option>
            <option value="To be number wannnn">To be number wannnn</option>
        </select>
        
        <div class="form-group">
            <label>Description : </label>
            <input placeholder="กรอกรายละเอียดการรับอาหาร หรือข้อมูลเพิ่มเติม" asp-for="deliverPost.Description" class="form-control" required=""/>
        </div>

        <button id="createbtn" type="submit" asp-area="" asp-controller="DeliverPost" asp-action="Create" class="btn btn-primary my-2">Create</button>
    </form>
</div>


<div id="addorderbox" style="border:1px solid black ;position:absolute;left:40%;top:50%;display:none">
    <p class="yellow">Your Order</p>
    <form method="post" asp-action="addOrder" asp-controller="DeliverPost">
        <div class="form-group">
            <label>FoodName : </label>
            <input id="enterfoodIT" placeholder="กรอกชื่ออาหารที่ต้องการ" name="foodName" class="form-control" required="" />
        </div>
        <div class="form-group">
            <label>Description : </label>
            <input id="enterdesIT" placeholder="กรอกรายละเอียดการรับอาหาร หรือข้อมูลเพิ่มเติม" name="description" class="form-control" required="" />
        </div>
        <div class="form-group">
            
            <input type="hidden" name="postId" id="postIdInput" value="" />
        </div>
        <button id="confirmAddOrderBtn" type="submit" asp-action="addOrder" asp-controller="DeliverPost" >Confirm</button>

        <button id="cancleAddOrderBtn" type="button">Cancle</button>

    </form>
</div>


@if (Model.deliverPosts != null)
{
    <div class="grid grid-cols-1 gap-16 m-3 pt-6 min[:grid-cols-2 lg:grid-cols-3 lg:px-10">
        @foreach (var post in Model.deliverPosts)
        {
            <div class="flex flex-col card-p">

                <div class="header yellow-div p-2 items-center">
                    <div class="grid grid-cols-10 h-full mx-2 py-2.5">
                        <div class="flex col-span-2 items-center justify-center">
                            <img class="w-16" style="border-radius: 50%;" src="https://cdn.discordapp.com/attachments/975683623804100679/1071003865773785129/A_doggie.webp" alt="Rounded avatar">
                        </div>
                        <div class="flex col-span-8 items-center justify-center">
                            <p class="text-center text-xl dark-blue md:text-lg lg:text-2xl">@post.Poster?.Username</p>
                        </div>
                    </div>
                </div>

                <div class="flex flex-row items-center h-full my-3 mx-4 divide-x-2 lg:mx-5">
                    <div class="basis-3/5 h-full space-y-2.5 mr-4">
                        <p class="yellow">Restaurant :</p>
                        <div>
                            <span class="px-3 py-0.5 text-xs border-2 border-black rounded-full md:text-sm thai">@post.Restaurant</span>
                        </div>
                        <p class="yellow">Description :</p>
                        <textarea id="style-2" rows="4" class="resize-none disable-scroll thai text-ms md:text-sm block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border-black border-2 "
                          disabled>@post.Description
                        </textarea>
                        <div class="bottom-0 left-0 text-sm  md:text-base"><p>@post.CreatedDate</p></div>
                    </div>

                    
                    <div class="flex basis-2/5 justify-center items-center h-full" style="border-color: #fdbf46;display:flex;flex-direction:column">
                        @{
                            int displayOpenamount = 0;
                            int openAmount = post.OpenAmount ?? default(int);
                            switch(openAmount)
                            {
                                case 0 :
                                    displayOpenamount = 5;
                                    break;
                                case 1:
                                    displayOpenamount = 4;
                                    break;
                                case 2:
                                    displayOpenamount = 3;
                                    break;
                                case 3:
                                    displayOpenamount = 2;
                                    break;
                                case 4:
                                    displayOpenamount = 1;
                                    break;
                                case 5:
                                    displayOpenamount = 0;
                                    break;


                            }
                        }
                        
                        
                        <p class="yellow">Amount @displayOpenamount/5</p>
                        @if (post.Status == true && post.PosterId != Model.account.Id)
                        {
                            <button id="buttonwhenenable" onclick=setPostId(@post.Id)  type="submit" style="height:100px"><span class="iconify" data-icon="material-symbols:add-circle-rounded" style="color: #fdbf46;" data-width="100" data-height="100"></span></button>                       
                                   
                        }
                        else
                        {   
                            <button id="buttonwhendisable" type="submit" style="height:100px;cursor:default"><span class="iconify" data-icon="material-symbols:add-circle-outline-rounded" style="color:lightgray" data-width="100" data-height="100"></span></button>
                        }

                        
                    </div>
                    
                    

                </div>
            </div>



            @*<div>
                
                @if (post.Status == true && post.PosterId != Model.account.Id)
                {
                    <form method="post" asp-action="AddOrder" asp-controller="DeliverPost" asp-route-postId="@post.Id">
                        <input placeholder="menu" name="foodName" class="form-control" required="">
                        <input placeholder="description" name="description" class="form-control" required="">
                        <button type="submit">Order</button>
                    </form>
                }
            </div>*@

        }
       
    </div>
}
<script>
    const createForm = document.getElementById("create-form");
    var postAiD;
    // Add an onsubmit event listener to the form
    createForm.addEventListener("submit", function (event) {
        // Get the values of the form inputs
        var restaurant = document.getElementById("deliverPost_Restaurant").value;
        var description = document.getElementById("deliverPost_Description").value;

        // Display the confirmation dialog with the form values
        var confirmCreate = confirm("Are you sure you want to create this post?\nDetail:\n\tRestaurant: " + restaurant + "\n\tDescription: " + description);

        // If the user clicked "Cancel", prevent the form submission
        if (!confirmCreate) {
            event.preventDefault();
        }
    });

    const addOrderBtn = document.getElementById("buttonwhenenable")
    const cancleAddOrder = document.getElementById("cancleAddOrderBtn")
    const box = document.getElementById('addorderbox');

    // Get all button elements outside of the box
    const buttons = document.querySelectorAll('button:not(#addorderbox button)');
    function enableExcecptBox()
    {
        for (let i = 0; i < buttons.length; i++) {
            buttons[i].onclick = null;
            buttons[i].classList.remove('disabled');
        }
    }

    function disableExcecptBox()
    {
        

        // Disable click event on all buttons outside of the box
        for (let i = 0; i < buttons.length; i++) {
            buttons[i].onclick = function (event) {
                event.preventDefault();
            };
            buttons[i].classList.add('disabled');
        }
    }

    addOrderBtn.addEventListener("click", function (event) {
        document.getElementById("addorderbox").style.display = "block";
        disableExcecptBox();
 
    });


    cancleAddOrder.addEventListener("click",function(event){
        clearAddOrder();
        enableExcecptBox();

    })

    function setPostId(postId)
    {
        postAiD = postId;
        document.getElementById("postIdInput").value = postAiD
    }

    function clearAddOrder()
    {
        document.getElementById("addorderbox").style.display = "none";
        document.getElementById("enterfoodIT").value = "";
        document.getElementById("enterdesIT").value = "";
        document.getElementById("postIdInput").value = "";
    }

    const clickableElements = document.querySelectorAll('.clickable');
    


</script>

