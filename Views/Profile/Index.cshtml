@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@using what_u_gonna_eat.ViewModels;

@model ProfileViewModel;
@{
    ViewData["Title"] = "Profile";
}

<h1 style="font-size: 24px">Profile</h1>
<div class="pb-3">
    <p>Name : @Model.account.Username</p></p>
    <p>Email : @Model.account.Email</p>
    @if(Model.account.PhoneNumber != null)
    {
        <p>Phone number: @Model.account.PhoneNumber</p>
    }
    else
    {
        <p>Phone number: - </p>
    }

    <a class="btn btn-warning"
       asp-controller="Profile"
       asp-action="Edit">Edit Profile</a>

</div>

<hr/>
<h1 class="pt-3" style="font-size:20px">History</h1>
<hr style="margin:30px 0" />
<h1 style="color: green; font-size:20px">Your Posts</h1>
<div>
    <h1 style="color: red; font-size:16px">Your Deliver Post</h1>
    @if (Model.deliverposts.Any(p=> p.PosterId == Model.account.Id))
    {
        @foreach(var post in Model.deliverposts)
    {
        @if(post.PosterId == Model.account.Id)
        {
            <div style="border: 1px solid black" class="p-3">
                @if (post.Status)
                {
                    <div id="statusbox" style="height:30px;width:35px;right:10px;top:10px;border:1px solid black;background;background-color:#164400;position:center; color: white" >เปิด</div>
                }
                else
                {
                    <div id="statusbox" style="right:10px;top:10px;border:1px solid black;background;background-color:#DA1820;color: white"><p>ปิด</p></div>
                }
                <p>Type : Deliver Post</p>
                <p>Restaurant : @post.Restaurant</p>
                <P>Description : @post.Description</P>

                @if (post.Orderers != null && post.Orderers.Any())
                {
                    <p>Orderers:</p>
                    <ul>
                        @foreach (var orderer in post.Orderers)
                        {
                            <li>@orderer.Orderer?.Username - @orderer.Menu - @orderer.Description</li>
                        }
                    </ul>
                }
                else
                {
                    <p>Oderer: none</p>
                }
                
                <!-- Use the asp-confirm attribute to display a confirmation dialog -->
                <form method="post" asp-action="Delete" asp-controller="DeliverPost" asp-route-postId="@post.Id">

                    <button id="deleteButton" class="btn btn-danger" asp-confirm="Are you sure you want to delete this post">Delete</button>
                </form>
                
            </div>
        }
    }
    }
    else
    {
        <div class="p-3" style="border: 1px solid black">
            You don't have any Deliver Posts yet.
        </div>
    }

    <h1 style="color: red; font-size:16px" style="color: red; font-size:16px">Your Eater Post</h1>
    @if(Model.eaterposts.Any(p=>p.PosterId == Model.account.Id))
    {
        @foreach (var post in Model.eaterposts)
        {
            @if (post.PosterId == Model.account.Id)
            {
            
                <div class="p-3" style="border: 1px solid black">
                    <p>Type : Eater Post</p>
                    <p>Menu : @post.Menu</p>
                    <P>Description : @post.Description</P>
                    <p>Buyer: @Model.eaterpostaccounts.FirstOrDefault(e => e.EaterPostId == post.Id)?.Buyer?.Username</p>
                
                        <!-- Use the asp-confirm attribute to display a confirmation dialog -->
                    <form method="post" asp-action="Delete" asp-controller="EaterPost" asp-route-postId="@post.Id">
                        <button id="deleteButton" class="btn btn-danger" asp-confirm="Are you sure you want to delete this post">Delete</button>
                    </form>
                </div>
            }
        }
    }
    else
    {
        <div class="p-3" style="border: 1px solid black">
            You don't have any Eater Posts yet.
        </div>
    }
</div>
<hr style="margin:30px 0"/>
<h1 style="color: green;font-size:20px">Your Orders</h1>
<div>
    <h2 style="color: red; font-size:16px">Orderers</h2>
    <div>
        @if(Model.orders.Any(o => o.OrdererId == Model.account.Id))
        {
            @foreach (var post in Model.orders)
            {
                @if (post.OrdererId == Model.account.Id)
                {
                    <div class="p-3" style="border: 1px solid black">
                        <p>Your Buyer : @post.DeliverPost.Poster.Username</p>
                        <p>Menu : @post.Menu</p>
                        <P>Description : @post.Description</P>
                    </div>
                }
            }
        }
        else
        {
            <div class="p-3" style="border: 1px solid black">
               You don't have any Orders yet.
            </div>
        }
    </div>

    <h2 style="color: red; font-size:16px">Buyer</h2>
    <div>
        @if(Model.eaterpostaccounts.Any(b=>b.BuyerId == Model.account.Id))
        {

            @foreach (var post in Model.eaterpostaccounts)
            {
                @if (post.BuyerId == Model.account.Id)
                {
                    <div class="p-3" style="border: 1px solid black">
                        <p>Buy for : @post.EaterPost.Poster.Username</p>
                        <p>Menu : @post.EaterPost.Menu</p>
                        <P>Description : @post.EaterPost.Description</P>
                    </div>
                }
            }
        }
        else
        {
            <div class="p-3" style="border: 1px solid black">
                You are not Buyer for anyone yet.
            </div>

        }
    </div>
</div>


<script>
    var deleteButton = document.getElementById("deleteButton");

    // Add an onclick event listener to the button
    deleteButton.addEventListener("click", function (event) {
        // Display the confirmation dialog
        var confirmDelete = confirm("Are you sure you want to delete this object?");

        // If the user clicked "Cancel", prevent the form submission
        if (!confirmDelete) {
            event.preventDefault();
        }
    });
</script>